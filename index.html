<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>義大利米蘭、威尼斯、佛羅倫斯與比薩八日深度之旅</title>
    <!-- 載入 Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 Chart.js CDN (已修正路徑) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!-- 載入 Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 設定字體為 Inter (Tailwind 預設，簡潔專業) */
        :root {
            --primary-color: #0077b6; /* 藍色系主色 */
            --secondary-color: #ade8f4; /* 淺藍色輔色 */
        }
      .text-primary { color: var(--primary-color); }
      .bg-primary { background-color: var(--primary-color); }
      .hover-bg-primary:hover { background-color: var(--primary-color); }
      .hover-text-primary:hover { color: var(--primary-color); }
        
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }

        /* 時間軸樣式 */
      .timeline-item {
            position: relative;
            padding-left: 2rem;
            border-left: 2px solid #ccc;
        }
      .timeline-item:last-child {
            border-left: none; /* 最後一項不需要線 */
        }
      .timeline-dot {
            position: absolute;
            left: -8px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--primary-color);
            border: 3px solid #f8fafc;
            z-index: 10;
        }

        /* 響應式調整 */
        @media (max-width: 768px) {
          .nav-item {
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
            }
        }
    </style>
</head>
<body>

    <div class="min-h-screen flex flex-col">
        
        <nav class="sticky top-0 z-20 bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <span class="text-xl font-bold text-primary">Aurora 義大利四城之旅</span>
                    </div>
                    <div class="flex space-x-1 md:space-x-4" id="nav-links">
                        <!-- 導覽連結將由 JS 插入 -->
                    </div>
                </div>
            </div>
        </nav>

        <main class="flex-grow max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div id="content-container">
                <!-- 內容會在此處切換 -->
            </div>
        </main>
        
        <footer class="bg-gray-800 text-white p-4 mt-8">
            <div class="max-w-7xl mx-auto text-center text-sm">
                &copy; 2025 專業旅遊規劃師設計。旅行日期: 2026/1/30 (出發) - 2026/2/7 (離境)
            </div>
        </footer>

    </div>

    <script>
        // ----------------------- 數據定義 (已修復與更新四城行程) -----------------------
        const TRIP_DATA = {
            overview: {
                destination: "米蘭 (Milan)、威尼斯 (Venice)、佛羅倫斯 (Florence) 與 比薩 (Pisa), 義大利",
                duration: "8 天 (2026/1/30 - 2026/2/7) 包含 7 晚住宿",
                members: "三人 (我和媽媽以及弟弟)",
                budget: "總營運預算約 €6,087 (約 NT$210,000)",
                style: "高效率、休閒、藝術與水都探索",
            },
            nav: [
                { id: 'overview', name: '行程總覽', icon: 'map' },
                { id: 'logistics', name: '交通住宿', icon: 'luggage' },
                { id: 'daily-plan', name: '每日行程', icon: 'calendar-check' },
                { id: 'food-map', name: '美食地圖', icon: 'utensils-crossed' },
                { id: 'checklist', name: '行前準備', icon: 'clipboard-list' }
            ],
            // Chart.js 數據 (已修復)
            chartData: {
                labels: ['米蘭 ⇌ 佛羅倫斯 HSR', '米蘭 ⇌ 威尼斯 HSR', '佛羅倫斯 ⇌ 威尼斯 HSR'],
                time: [100, 135, 120], // 時間 (分鐘)
                cost: [65, 55, 60], // 預估單人費用 (€)
                datasets: [
                    {
                        type: 'bar',
                        label: '旅行時間 (分鐘)',
                        data: [100, 135, 120],
                        backgroundColor: 'rgba(0, 119, 182, 0.7)',
                        yAxisID: 'y1',
                    },
                    {
                        type: 'line',
                        label: '預估單人成本 (€)',
                        data: [65, 55, 60],
                        backgroundColor: 'rgba(251, 191, 36, 0.8)',
                        borderColor: 'rgba(251, 191, 36, 1)',
                        yAxisID: 'y2',
                        tension: 0.3,
                    }
                ]
            },
            // 每日行程 (已修復並重建)
            dailyPlan: [
                // Day 1: 1/31 (六) - 抵達米蘭 (2晚)
                { day: 1, date: '1/31 (六)', city: '米蘭 (Milan)', theme: '抵達、休整與核心風光', activities: [
                    { time: '上午', title: '07:00 抵達米蘭 Malpensa (MXP) 機場', transport: 'EVA Air BR 95', stay: '', notes: '清晨抵達，優先前往公寓寄放行李' },
                    { time: '上午', title: '搭乘 Malpensa Express 至市區與入住/寄放', transport: '機場火車 (MXP Express)', duration: '約 1 小時', mapLink: 'https://maps.app.goo.gl/v94gW1qjS8L2yD227', notes: '公寓應靠近中央車站' },
                    { time: '中午', title: '周邊輕食與休整', transport: '步行', stay: '1.5 小時', notes: '適當休息後開始下午行程' },
                    { time: '下午', title: 'Duomo di Milano (米蘭大教堂)', transport: '地鐵', stay: '2.5 小時', mapLink: 'https://maps.app.goo.gl/h1g4W1Z8oQ9Z3E3V9', notes: '建議登頂（露台），俯瞰城市' },
                    { time: '晚餐', title: 'Navigli 運河區散步與晚餐', transport: '地鐵/步行', stay: '2 小時', mapLink: 'https://maps.app.goo.gl/XwS1t4pU3E6hA83R9', notes: '享受運河夜景' },
                ]},
                // Day 2: 2/1 (日) - 米蘭 -> 威尼斯 (2晚)
                { day: 2, date: '2/1 (日)', city: '轉場 ⇌ 威尼斯', theme: '米蘭藝術與水都轉場', activities: [
                    { time: '上午', title: 'Pinacoteca di Brera (布雷拉畫廊)', transport: '地鐵', stay: '2 小時', mapLink: 'https://maps.app.goo.gl/G6L9p8sJ7K8zR1Q58', notes: '欣賞文藝復興藝術品' },
                    { time: '中午', title: '米蘭中央車站附近午餐', transport: '步行', stay: '1 小時' },
                    { time: '下午', title: '搭乘高速列車 (HSR) 前往威尼斯', transport: 'Frecciarossa/Italo (M→V)', duration: '約 2 小時 15 分鐘', mapLink: 'https://maps.app.goo.gl/7A1gH6mE5sF9jK3Y9', notes: '抵達 Venezia Santa Lucia 站' },
                    { time: '傍晚', title: '入住威尼斯公寓', transport: 'Vaporetto/步行', stay: '1 小時', notes: '尋找近 Santa Lucia 站的公寓' },
                    { time: '晚餐', title: 'Rialto 區休閒散步與晚餐', transport: 'Vaporetto/步行', stay: '2 小時', mapLink: 'https://maps.app.goo.gl/u3F8zF9jK3Y9Q8W7', notes: '探索威尼斯市中心地標' },
                ]},
                // Day 3: 2/2 (一) - 威尼斯核心景點 & 嘉年華
                { day: 3, date: '2/2 (一)', city: '威尼斯 (Venice)', theme: '水都核心與面具嘉年華氛圍', activities: [
                    { time: '上午', title: 'San Marco Square (聖馬可廣場)', transport: '步行/Vaporetto', stay: '2 小時', mapLink: 'https://maps.app.goo.gl/P6nE8zF9jK3Y9Q8W7', notes: '欣賞總督宮、聖馬可大教堂外觀' },
                    { time: '中午', title: '聖馬可廣場周邊午餐', transport: '步行', stay: '1 小時' },
                    { time: '下午', title: 'Rialto Bridge 與當地市場探索', transport: '步行', stay: '2 小時', mapLink: 'https://maps.app.goo.gl/M6nE8zF9jK3Y9Q8W7', notes: '感受當地生活氣息' },
                    { time: '傍晚', title: 'Gondola Ride 或 Grand Canal Vaporetto Tour', transport: 'Gondola 或 Vaporetto', stay: '1.5 小時', notes: '享受威尼斯水上風光，感受嘉年華裝飾' },
                    { time: '晚餐', title: 'Bacari (Cicchetti 小吃) 之旅', transport: '步行', stay: '2 小時', mapLink: 'https://maps.app.goo.gl/B4rE8zF9jK3Y9Q8W7', notes: '探索 Dorsoduro 區 Cantine del Vino già Schiavi' },
                ]},
                // Day 4: 2/3 (二) - 威尼斯 -> 佛羅倫斯 (2晚)
                { day: 4, date: '2/3 (二)', city: '轉場 ⇌ 佛羅倫斯', theme: '彩色島嶼與高效移動', activities: [
                    { time: '上午', title: 'Murano 或 Burano 外島日遊 (擇一)', transport: 'Vaporetto', duration: '3 小時', mapLink: 'https://maps.app.goo.gl/Q6nE8zF9jK3Y9Q8W7', notes: '欣賞彩色房屋或玻璃工藝 (高效率行程，僅選一島)' },
                    { time: '中午', title: '威尼斯公寓退房與午餐', transport: '步行', stay: '1.5 小時', notes: '返回 Santa Lucia 車站附近用餐' },
                    { time: '下午', title: '搭乘高速列車 (HSR) 前往佛羅倫斯', transport: 'Frecciarossa/Italo (V→F)', duration: '約 2 小時 0 分鐘', mapLink: 'https://maps.app.goo.gl/A4rE8zF9jK3Y9Q8W7', notes: '抵達佛羅倫斯 SMN 站' },
                    { time: '傍晚', title: '入住佛羅倫斯公寓與休整', transport: '步行/巴士', stay: '1 小時', notes: '公寓靠近 SMN 站' },
                    { time: '晚餐', title: '佛羅倫斯在地 Trattoria 晚餐', transport: '步行', stay: '1.5 小時', notes: '品嚐托斯卡納經典菜餚' },
                ]},
                // Day 5: 2/4 (三) - 比薩日遊
                { day: 5, date: '2/4 (三)', city: '比薩 (Pisa) 日遊', theme: '世界遺產與斜塔', activities: [
                    { time: '上午', title: '搭乘區域火車 (Regionale) 前往比薩', transport: '火車 (SMN - Pisa Centrale)', duration: '約 1 小時 0 分鐘', mapLink: 'https://maps.app.goo.gl/E2jE8zF9jK3Y9Q8W7', notes: '單程約 €9/人，班次密集' },
                    { time: '中午', title: '奇蹟廣場 (Piazza dei Miracoli) 參觀與午餐', transport: '巴士 LAM ROSSA 或步行', duration: '4 小時', mapLink: 'https://maps.app.goo.gl/T4rE8zF9jK3Y9Q8W7', notes: '包含比薩斜塔、大教堂、洗禮堂' },
                    { time: '下午', title: '搭乘區域火車返回佛羅倫斯', transport: '火車 (Pisa Centrale - SMN)', duration: '約 1 小時 0 分鐘', mapLink: 'https://maps.app.goo.gl/E2jE8zF9jK3Y9Q8W7' },
                    { time: '晚餐', title: 'Mercato Centrale (中央市場) 美食探索', transport: '步行', stay: '1.5 小時', mapLink: 'https://maps.app.goo.gl/9yF7hJ2u8B5wL4Q6A', notes: '嘗試牛肚包 (Lampredotto)' },
                ]},
                // Day 6: 2/5 (四) - 佛羅倫斯藝術與景觀 (2晚結束)
                { day: 6, date: '2/5 (四)', city: '佛羅倫斯 (Florence)', theme: '文藝復興深度鑑賞', activities: [
                    { time: '上午/中午', title: 'Uffizi Gallery (烏菲茲美術館)', transport: '步行', stay: '3.5 小時', mapLink: 'https://maps.app.goo.gl/K6mE3sF9jK3Y9Q8W7', notes: '深度藝術鑑賞，建議提前預訂門票' },
                    { time: '下午', title: 'Accademia Gallery (佛羅倫斯美術學院)', transport: '步行', stay: '1.5 小時', mapLink: 'https://maps.app.goo.gl/H3mE5sF9jK3Y9Q8W7', notes: '參觀米開朗基羅的大衛像 (Day 4 已參觀大衛像，此處為複查)' },
                    { time: '傍晚', title: 'Piazzale Michelangelo (米開朗基羅廣場)', transport: '巴士 (ATAF)', stay: '1.5 小時', mapLink: 'https://maps.app.goo.gl/J2nE8zF9jK3Y9Q8W7', notes: '眺望佛羅倫斯城市全景與夕陽' },
                    { time: '晚餐', title: 'Oltrarno 區品嚐 Florentine Steak', transport: '巴士/步行', stay: '2 小時', notes: '享受高品質托斯卡納晚餐' },
                ]},
                // Day 7: 2/6 (五) - 轉場回米蘭 (1晚)
                { day: 7, date: '2/6 (五)', city: '轉場 ⇌ 米蘭', theme: '購物與回程準備', activities: [
                    { time: '上午', title: '佛羅倫斯市區最後活動與購物', transport: '步行', stay: '3 小時', notes: 'Ponte Vecchio (老橋) 散步與購物' },
                    { time: '中午', title: '佛羅倫斯公寓退房與午餐', transport: '步行', stay: '1.5 小時', notes: '確保不超時，前往 SMN 車站' },
                    { time: '下午', title: '搭乘高速列車 (HSR) 返回米蘭', transport: 'Frecciarossa/Italo (F→M)', duration: '約 1 小時 40 分鐘', notes: '返回米蘭中央車站 (Centrale)' },
                    { time: '傍晚', title: '入住米蘭中央車站附近公寓', transport: '地鐵/步行', stay: '1 晚', notes: '預訂靠近車站的住宿，便於隔日前往機場' },
                    { time: '晚餐', title: '米蘭中央車站附近晚餐與整理行李', transport: '步行', stay: '2 小時', notes: '在中央車站附近用餐，整理行李為 Day 8 離境做準備' },
                ]},
                // Day 8: 2/7 (六) - 離境
                { day: 8, date: '2/7 (六)', city: '米蘭 (Milan)', theme: '離境', activities: [
                    { time: '上午', title: '米蘭公寓退房並前往 MXP', transport: '步行/機場火車 (MXP Express)', duration: '約 1 小時', mapLink: 'https://maps.app.goo.gl/v94gW1qjS8L2yD227', notes: '搭乘 Express 前往 Malpensa 機場' },
                    { time: '上午', title: '辦理登機手續', transport: '步行', notes: '請預留充足時間 (11:00 AM 航班)' },
                    { time: '中午', title: '搭乘 EVA Air BR 96 離境', transport: '飛機', stay: '' },
                    { time: '隔日', title: '2/8 (日) 抵達桃園機場', transport: '飛機', stay: '' },
                ]},
            ],
            // 美食地圖 (已修復並新增威尼斯)
            foodMap: [
                { name: 'Pizzium (米蘭)', cuisine: 'Lombard/Pizza', dish: '正宗拿坡里披薩', mapLink: 'https://maps.app.goo.gl/A4rE8zF9jK3Y9Q8W7' },
                { name: 'Ossobuco Trattoria (米蘭)', cuisine: 'Lombard/Classic', dish: '燉小牛膝、米蘭燉飯', mapLink: 'https://maps.app.goo.gl/B4rE8zF9jK3Y9Q8W7' },
                { name: 'Bacaro 體驗 (威尼斯)', cuisine: 'Venetian/Cicchetti/Seafood', dish: 'Cicchetti (水都小吃)、海鮮', mapLink: 'https://maps.app.goo.gl/C3rE8zF9jK3Y9Q8W7', notes: '探索 Dorsoduro 區 Cantine del Vino già Schiavi' },
                { name: 'Trattoria Marione (佛羅倫斯)', cuisine: 'Tuscan/Classic', dish: 'Ribollita (冬季濃湯)、Peposo', mapLink: 'https://maps.app.goo.gl/C4rE8zF9jK3Y9Q8W7' },
                { name: '中央市場攤位 (佛羅倫斯)', cuisine: 'Tuscan/Street Food', dish: 'Panino con Lampredotto (牛肚包)', mapLink: 'https://maps.app.goo.gl/D4rE8zF9jK3Y9Q8W7' },
            ],
            foodFilters: [
                { key: 'all', name: '全部美食' },
                { key: 'Lombard', name: '米蘭經典 (倫巴底)' },
                { key: 'Venetian', name: '威尼斯經典 (水都)' },
                { key: 'Tuscan', name: '佛羅倫斯經典 (托斯卡納)' },
                { key: 'Street Food', name: '街頭小吃' },
                { key: 'Seafood', name: '海鮮' }
            ]
        };

        let currentActiveSection = 'overview';
        let transportChart = null;

        // ----------------------- 網頁渲染函式 -----------------------
        
        /** 導覽列渲染與初始化 */
        function initNavigation() {
            const navLinksContainer = document.getElementById('nav-links');
            navLinksContainer.innerHTML = TRIP_DATA.nav.map(item => `
                <a href="#" id="nav-${item.id}" 
                   class="nav-item text-gray-700 hover:text-primary px-3 py-2 rounded-md font-medium transition-colors duration-200 flex items-center" 
                   data-section="${item.id}"
                >
                    <i data-lucide="${item.icon}" class="w-4 h-4 mr-1"></i>
                    <span class="hidden sm:inline">${item.name}</span>
                </a>
            `).join('');

            // 添加事件監聽器
            document.querySelectorAll('.nav-item').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = e.currentTarget.getAttribute('data-section');
                    switchSection(sectionId);
                });
            });
            switchSection(currentActiveSection); // 初始載入
        }

        /** 切換主要區塊內容 */
        function switchSection(sectionId) {
            currentActiveSection = sectionId;
            const contentContainer = document.getElementById('content-container');
            const navItems = document.querySelectorAll('.nav-item');

            // 更新導覽列樣式
            navItems.forEach(item => {
                item.classList.remove('bg-secondary', 'text-primary');
                item.classList.add('text-gray-700');
            });
            document.getElementById(`nav-${sectionId}`).classList.add('bg-secondary', 'text-primary');
            document.getElementById(`nav-${sectionId}`).classList.remove('text-gray-700');

            // 渲染內容
            contentContainer.innerHTML = '';
            switch (sectionId) {
                case 'overview':
                    contentContainer.innerHTML = renderOverview();
                    // 重新初始化 Chart.js (需等待 DOM 渲染完成)
                    setTimeout(initTransportChart, 50); 
                    break;
                case 'logistics':
                    contentContainer.innerHTML = renderLogistics();
                    break;
                case 'daily-plan':
                    contentContainer.innerHTML = renderDailyPlan();
                    // 重新初始化 Lucide Icons
                    lucide.createIcons();
                    break;
                case 'food-map':
                    contentContainer.innerHTML = renderFoodMap();
                    // 初始篩選
                    filterFoodMap('all');
                    break;
                case 'checklist':
                    contentContainer.innerHTML = renderChecklist();
                    break;
            }
            // 確保每次切換後圖標都能被渲染 (因為 DOM 內容變了)
            lucide.createIcons();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        /** 渲染行程總覽 */
        function renderOverview() {
            const data = TRIP_DATA.overview;
            return `
                <h1 class="text-4xl font-extrabold mb-6 text-gray-800 border-b-4 border-primary pb-2">行程總覽 - 義大利四城深度遊</h1>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                        <i data-lucide="plane" class="w-6 h-6 text-primary mb-2"></i>
                        <p class="text-gray-500 text-sm">目的地</p>
                        <p class="text-xl font-semibold">${data.destination}</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                        <i data-lucide="clock" class="w-6 h-6 text-primary mb-2"></i>
                        <p class="text-gray-500 text-sm">日期與天數</p>
                        <p class="text-xl font-semibold">${data.duration}</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                        <i data-lucide="users" class="w-6 h-6 text-primary mb-2"></i>
                        <p class="text-gray-500 text-sm">同行成員</p>
                        <p class="text-xl font-semibold">${data.members}</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                        <i data-lucide="euro" class="w-6 h-6 text-primary mb-2"></i>
                        <p class="text-gray-500 text-sm">總預算 (營運)</p>
                        <p class="text-xl font-semibold">${data.budget}</p>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-xl shadow-2xl mb-10 border border-gray-100">
                    <h2 class="text-2xl font-bold mb-4 text-gray-700">義大利 HSR 核心路段效率比較</h2>
                    <p class="text-gray-500 mb-6">比較幾個主要城際路段的高速列車時間與單人預估成本，體現高效轉場的優勢。</p>
                    <div class="h-96">
                        <canvas id="transportChart"></canvas>
                    </div>
                </div>

                <div class="bg-secondary/30 p-6 rounded-xl border border-primary/50">
                    <h3 class="text-xl font-bold mb-3 text-primary flex items-center">
                        <i data-lucide="star" class="w-5 h-5 mr-2 fill-primary/30"></i> 旅遊風格與哲學
                    </h3>
                    <p class="text-gray-700">${data.style}。本行程為**高強度高效**的四城巡禮，利用 HSR 網絡將移動時間最小化，以確保您能體驗米蘭的現代、威尼斯的水都、佛羅倫斯的藝術與比薩的古蹟。請準備好應對緊湊的行程與多次轉場。</p>
                </div>
            `;
        }
        
        /** 初始化 Chart.js 圖表 */
        function initTransportChart() {
            if (transportChart) {
                transportChart.destroy();
            }
            const ctx = document.getElementById('transportChart').getContext('2d');
            
            const data = TRIP_DATA.chartData;

            transportChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: data.datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { usePointStyle: true } },
                        title: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    scales: {
                        x: { grid: { display: false } },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: '時間 (分鐘)', color: 'rgba(0, 119, 182, 1)' },
                            min: 0,
                            max: 250,
                            grid: { drawOnChartArea: false }
                        },
                        y2: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: '單人成本 (€)', color: 'rgba(251, 191, 36, 1)' },
                            min: 0,
                            max: 100,
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        /** 渲染交通住宿區塊 */
        function renderLogistics() {
            return `
                <h1 class="text-4xl font-extrabold mb-6 text-gray-800 border-b-4 border-primary pb-2">交通住宿與費用細則</h1>
                
                <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-primary/50">
                    <h2 class="text-2xl font-bold mb-4 text-primary flex items-center">
                        <i data-lucide="calendar-check" class="w-5 h-5 mr-2"></i> 核心路段總車程確認 (高鐵/快車)
                    </h2>
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="text-sm font-semibold text-gray-600 border-b">
                                <th class="py-2">路段</th>
                                <th class="py-2">交通方式</th>
                                <th class="py-2">預估單程時間</th>
                                <th class="py-2">單人預估費用</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-gray-100">
                                <td class="py-2 text-gray-800">米蘭 → 威尼斯</td>
                                <td class="py-2 text-primary font-medium">HSR (Italo/Frecciarossa)</td>
                                <td class="py-2 font-semibold">2 小時 15 分鐘</td>
                                <td class="py-2">約 €55 (早鳥價)</td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="py-2 text-gray-800">威尼斯 → 佛羅倫斯</td>
                                <td class="py-2 text-primary font-medium">HSR (Italo/Frecciarossa)</td>
                                <td class="py-2 font-semibold">2 小時 0 分鐘</td>
                                <td class="py-2">約 €60 (早鳥價)</td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="py-2 text-gray-800">佛羅倫斯 → 米蘭</td>
                                <td class="py-2 text-primary font-medium">HSR (Italo/Frecciarossa)</td>
                                <td class="py-2 font-semibold">1 小時 40 分鐘</td>
                                <td class="py-2">約 €65 (早鳥價)</td>
                            </tr>
                            <tr class="bg-secondary/30 font-bold">
                                <td class="py-2 text-gray-800">總核心移動時間 (淨值)</td>
                                <td class="py-2 text-primary" colspan="3">約 5 小時 55 分鐘</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-100">
                    <h2 class="text-2xl font-bold mb-4 text-primary flex items-center">
                        <i data-lucide="home" class="w-5 h-5 mr-2"></i> 住宿建議 (4 城轉場，共 7 晚)
                    </h2>
                    <p class="text-gray-700 mb-3">為確保洗衣需求與家庭舒適，仍堅持高品質自炊公寓，但需要多次打包與移動：**2N 米蘭 → 2N 威尼斯 → 2N 佛羅倫斯 → 1N 米蘭**</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-600">
                        <li>**米蘭 (3 晚):** 建議選擇 <span class="font-semibold text-gray-800">中央車站 (Centrale) 附近</span>，方便機場與 HSR 轉乘。</li>
                        <li>**威尼斯 (2 晚):** 建議選擇 <span class="font-semibold text-gray-800">Santa Lucia 火車站附近或 Cannaregio 區</span>，便於轉場與 Vaporetto 使用。</li>
                        <li>**佛羅倫斯 (2 晚):** 建議選擇 <span class="font-semibold text-gray-800">SMN 火車站附近</span>，便於進行比薩日遊和 HSR 轉乘。</li>
                        <li>**關鍵設施:** 所有住宿必須具備洗衣間/洗衣機。</li>
                    </ul>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-100">
                    <h2 class="text-2xl font-bold mb-4 text-primary flex items-center">
                        <i data-lucide="train" class="w-5 h-5 mr-2"></i> 城市內部交通
                    </h2>
                    <div class="space-y-4">
                        <h3 class="font-semibold text-lg text-gray-800 border-b pb-1">威尼斯水上交通 (Vaporetto)</h3>
                        <p class="text-gray-700">推薦購買 Vaporetto **48 小時通票** (€35/人)，以應對主島和外島的交通需求。</p>
                        
                        <h3 class="font-semibold text-lg text-gray-800 border-b pb-1">比薩日遊</h3>
                        <p class="text-gray-700">佛羅倫斯 ⇌ 比薩採用區域火車 (Regionale)，單程最快 **51 分鐘**，往返約 €10/人。</p>
                    </div>
                </div>
            `;
        }

        /** 渲染每日行程 (時間軸) */
        function renderDailyPlan() {
            return `
                <h1 class="text-4xl font-extrabold mb-8 text-gray-800 border-b-4 border-primary pb-2">每日行程時間軸 (4 城壓縮版)</h1>
                
                <div class="space-y-12">
                    ${TRIP_DATA.dailyPlan.map(day => `
                        <div class="bg-white p-6 rounded-xl shadow-xl border border-gray-100">
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 pb-2 border-b border-secondary">
                                <h2 class="text-2xl font-bold text-primary flex items-center">
                                    <span class="mr-3 p-1 rounded-full bg-secondary text-primary font-mono text-lg">${day.day}</span>
                                    ${day.city} - ${day.theme}
                                </h2>
                                <span class="text-sm text-gray-500 mt-1 sm:mt-0">${day.date}</span>
                            </div>
                            
                            <div class="space-y-6">
                                ${day.activities.map(activity => `
                                    <div class="timeline-item">
                                        <div class="timeline-dot"></div>
                                        <div class="ml-4">
                                            <p class="text-lg font-semibold text-gray-800">${activity.title}</p>
                                            <div class="text-sm text-gray-600 mt-1 space-y-1">
                                                <p class="flex items-center"><i data-lucide="route" class="w-4 h-4 mr-1 text-gray-500"></i>交通：${activity.transport} ${activity.duration? `(${activity.duration})` : ''}</p>
                                                ${activity.stay? `<p class="flex items-center"><i data-lucide="timer" class="w-4 h-4 mr-1 text-gray-500"></i>停留時間：${activity.stay}</p>` : ''}
                                                ${activity.notes? `<p class="text-xs text-gray-500 italic">備註：${activity.notes}</p>` : ''}
                                                ${activity.mapLink? `<a href="${activity.mapLink}" target="_blank" class="text-primary hover:underline text-sm flex items-center mt-1">
                                                    <i data-lucide="map-pin" class="w-3 h-3 mr-1"></i> Google Maps 連結
                                                </a>` : ''}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        /** 渲染美食地圖區塊 */
        function renderFoodMap() {
            return `
                <h1 class="text-4xl font-extrabold mb-6 text-gray-800 border-b-4 border-primary pb-2">必吃美食地圖</h1>
                <p class="text-gray-500 mb-6">我們為您精選了米蘭、威尼斯與佛羅倫斯的在地經典美食。點擊下方的標籤進行篩選。</p>

                <div class="flex flex-wrap gap-3 mb-8" id="food-filters">
                    ${TRIP_DATA.foodFilters.map(filter => `
                        <button 
                            data-filter="${filter.key}"
                            onclick="filterFoodMap('${filter.key}')"
                            class="filter-btn px-4 py-2 text-sm font-semibold rounded-full border border-gray-300 bg-white text-gray-700 hover:bg-secondary hover:border-primary transition-colors duration-150"
                        >
                            ${filter.name}
                        </button>
                    `).join('')}
                </div>

                <div id="food-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- 餐廳卡片將由 JS 插入 -->
                </div>
            `;
        }

        /** 美食篩選邏輯 (已修復邏輯運算符號) */
        function filterFoodMap(filterKey) {
            const listContainer = document.getElementById('food-list');
            const buttons = document.querySelectorAll('.filter-btn');

            // 更新按鈕樣式
            buttons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white', 'border-primary');
                btn.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
                if (btn.getAttribute('data-filter') === filterKey) {
                    btn.classList.add('bg-primary', 'text-white', 'border-primary');
                    btn.classList.remove('bg-white', 'text-gray-700');
                }
            });

            // 篩選數據 (修復了 ' | ' 為 ' || ')
            const filteredData = TRIP_DATA.foodMap.filter(item => 
                filterKey === 'all' || item.cuisine.includes(filterKey)
            );

            // 渲染結果
            listContainer.innerHTML = filteredData.map(item => `
                <div class="bg-white p-5 rounded-xl shadow-md transition-shadow duration-300 hover:shadow-lg border-l-4 border-primary" data-cuisine="${item.cuisine}">
                    <h3 class="text-xl font-bold mb-2 text-gray-800">${item.name}</h3>
                    <p class="text-sm font-medium text-primary mb-2">${item.cuisine.split('/').join(' | ')}</p>
                    <p class="text-gray-600 mb-3">**必試菜餚:** ${item.dish} ${item.notes ? `(${item.notes})` : ''}</p>
                    <a href="${item.mapLink}" target="_blank" class="text-primary hover:underline transition-colors duration-200 text-sm font-semibold flex items-center">
                        <i data-lucide="map" class="w-4 h-4 mr-1"></i> 查看 Google 地圖
                    </a>
                </div>
            `).join('');
            
            // 重新渲染 Lucide Icons
            lucide.createIcons();
        }

        /** 渲染行前準備區塊 */
        function renderChecklist() {
            return `
                <h1 class="text-4xl font-extrabold mb-6 text-gray-800 border-b-4 border-primary pb-2">行前準備與注意事項</h1>
                
                <div class="bg-white p-6 rounded-xl shadow-xl border border-gray-100 space-y-6">
                    
                    <div class="border-b pb-4">
                        <h2 class="text-2xl font-bold mb-3 text-primary flex items-center">
                            <i data-lucide="ticket" class="w-5 h-5 mr-2"></i> 門票與交通預訂 (必備)
                        </h2>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li>**HSR 列車票:** 由於行程緊湊，米蘭/威尼斯/佛羅倫斯之間的 HSR 票務務必提前預訂，以確保座位和最低價格。</li>
                            <li>**威尼斯交通:** 提前購買 **48 小時 Vaporetto 通票**，以應對主島和外島的交通需求。</li>
                            <li>**主要博物館門票:** Uffizi Gallery、Accademia Gallery 和總督宮務必提前預訂，節省寶貴的遊覽時間。</li>
                            <li>**比薩斜塔登塔:** 如需登塔，請務必提前預訂門票。</li>
                        </ul>
                    </div>

                    <div class="border-b pb-4">
                        <h2 class="text-2xl font-bold mb-3 text-primary flex items-center">
                            <i data-lucide="package" class="w-5 h-5 mr-2"></i> 行李與轉場策略
                        </h2>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li>**輕量化行李:** 由於行程包含三次城市轉場和一次日遊，強烈建議採用輕便、易於搬運的行李。</li>
                            <li>**住宿設施:** 確認所有住宿都提供洗衣間，以滿足您的家庭需求。</li>
                        </ul>
                    </div>

                    <div class="pb-4">
                        <h2 class="text-2xl font-bold mb-3 text-primary flex items-center">
                            <i data-lucide="wallet" class="w-5 h-5 mr-2"></i> 預算與溫馨提醒
                        </h2>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li>**行程強度:** 此四城行程極為緊湊。建議保持作息規律，並利用 HSR 的時間休息，以確保休閒品質。</li>
                            <li>**弟弟的交通:** 查閱米蘭 AATM 官網，確認「弟弟」的年齡是否符合免費搭乘大眾運輸的條件。</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // ----------------------- 啟動程式碼 -----------------------
        document.addEventListener('DOMContentLoaded', () => {
            initNavigation();
        });

    </script>
</body>
</html>
